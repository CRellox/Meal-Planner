<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const filterButtons = document.querySelectorAll('#filterButtons button');
        const mealRows = document.querySelectorAll('.meal-row');
        const totalMealsCount = document.getElementById('totalMealsCount');
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');

        let currentFilter = 'all';
        let currentSearch = '';

        // Function to apply both filters
        function applyFilters() {
            let visibleCount = 0;

            mealRows.forEach(row => {
                const mealType = row.getAttribute('data-meal-type');
                const mealName = row.querySelector('h6').textContent.toLowerCase();
                const ingredients = row.querySelector('p').textContent.toLowerCase();
                const instructions = row.querySelector('.instructions-preview').textContent.toLowerCase();

                const matchesFilter = currentFilter === 'all' || mealType === currentFilter;
                const matchesSearch = currentSearch === '' ||
                    mealName.includes(currentSearch) ||
                    ingredients.includes(currentSearch) ||
                    instructions.includes(currentSearch);

                if (matchesFilter && matchesSearch) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            // Update the visible meals count
            totalMealsCount.textContent = visibleCount;
        }
    }

        // Meal type filter functionality
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                filterButtons.forEach(btn => {
                    btn.classList.remove('btn-primary', 'active');
                    btn.classList.add('btn-outline-primary');
                });

                // Add active class to clicked button
                this.classList.remove('btn-outline-primary');
                this.classList.add('btn-primary', 'active');

                currentFilter = this.getAttribute('data-filter');
                applyFilters();
            });
        });

        // Search functionality
        searchInput.addEventListener('input', function() {
            currentSearch = this.value.toLowerCase();
            applyFilters();
        });

        // Clear search
        clearSearch.addEventListener('click', function() {
            searchInput.value = '';
            currentSearch = '';
            applyFilters();
            searchInput.focus();
        });

    mealRows.forEach(row => {
        row.addEventListener('click', function(e) {
            if (e.target.closest('button') ||
                e.target.closest('a') ||
                e.target.closest('.meal-actions') ||
                e.target.closest('form')) {
                return;
            }

            const uuid = this.getAttribute('data-meal-uuid');
            if (uuid) {
                window.location.href = `/mealplanner/meal/view/${uuid}`;
            }
        });
    });
});
</script>